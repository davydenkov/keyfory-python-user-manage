–¢–µ—Å—Ç–æ–≤–æ–µ –∑–∞–¥–∞–Ω–∏–µ: –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ REST API –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
–¶–µ–ª—å:
–°–æ–∑–¥–∞—Ç—å REST API –Ω–∞ –±–∞–∑–µ LiteStar (Python 3.12) —Å CRUD-–æ–ø–µ—Ä–∞—Ü–∏—è–º–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã user –≤ PostgreSQL. –ü–æ–∫–∞–∑–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥.

–£—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏:
–í —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ github —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–µ—Ä–≤—ã–π –∫–æ–º–º–∏—Ç –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Å –Ω–∞–∑–≤–∞–Ω–∏–µ (start yyyy-mm-dd). –ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è —Å–æ–∑–¥–∞—ë—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–π –∫–æ–º–º–∏—Ç (end yyyy-mm-dd). –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É —ç—Ç–∏–º –≤—Ä–µ–º–µ–Ω–µ–º –±—É–¥–µ—Ç —è–≤–ª—è—Ç—å—Å—è —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–º –≤—Ä–µ–º–µ–Ω–µ–º.

‚öôÔ∏è –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ API
API –¥–æ–ª–∂–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å:

‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é Swagger

‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

‚úÖ –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

 

2. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ trace_id (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —á–∞—Å—Ç—å)
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å structlog –∫–∞–∫ –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–≥–µ—Ä.

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å middleware, –∫–æ—Ç–æ—Ä—ã–π:

—á–∏—Ç–∞–µ—Ç X-Request-Id –∏–∑ –≤—Ö–æ–¥—è—â–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π trace_id (–µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç - —É –Ω–∞—Å –µ–≥–æ –Ω–µ –±—É–¥–µ—Ç);

–¥–æ–±–∞–≤–ª—è–µ—Ç trace_id –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –ª–æ–≥–≥–µ—Ä–∞;

–ª–æ–≥–∏—Ä—É–µ—Ç –Ω–∞—á–∞–ª–æ –∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ (–º–µ—Ç–æ–¥, –ø—É—Ç—å, —Å—Ç–∞—Ç—É—Å, –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è);

–ª–æ–≥–∏—Ä—É–µ—Ç –æ—à–∏–±–∫–∏ —Å —Ç–µ–º –∂–µ trace_id.

trace_id –¥–æ–ª–∂–µ–Ω:

–ø—Ä–∏—Å—É—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –≤ –∫–∞–∂–¥–æ–π –ª–æ–≥-–∑–∞–ø–∏—Å–∏, —Å–≤—è–∑–∞–Ω–Ω–æ–π —Å –∑–∞–ø—Ä–æ—Å–æ–º;

–≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –∫–ª–∏–µ–Ω—Ç—É –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ –æ—Ç–≤–µ—Ç–∞, –Ω–∞–ø—Ä–∏–º–µ—Ä X-Trace-Id.

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ª—é–±–æ–π —É–¥–æ–±–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –ª–æ–≥–æ–≤ (JSON / key=value), –≥–ª–∞–≤–Ω–æ–µ ‚Äî —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ—Å—Ç—å –∏ –Ω–∞–ª–∏—á–∏–µ trace_id.

 

 

3.1 –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å RabbitMQ (–Ω–æ–º–∏–Ω–∞–ª—å–Ω–æ, –Ω–æ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)
–¶–µ–ª—å ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–π –ø–æ–¥—Ö–æ–¥, –º–µ—Å—Ç–æ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è  –∏ —Ä–∞–±–æ—Ç—É —Å trace_id —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å, –∞ –Ω–µ —Å–¥–µ–ª–∞—Ç—å —Å–ª–æ–∂–Ω—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É.

–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å faststream (c aio-pika) –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å RabbitMQ.

–î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–π –ø—Ä–æ—Å—Ç–æ–π —Å—Ö–µ–º—ã:

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
—Å–µ—Ä–≤–∏—Å –ø—É–±–ª–∏–∫—É–µ—Ç —Å–æ–±—ã—Ç–∏–µ –≤ RabbitMQ, –Ω–∞–ø—Ä–∏–º–µ—Ä:

user.created

user.updated

user.deleted

–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–±—ã—Ç–∏—è ‚Äî –Ω–∞ –≤–∞—à–µ —É—Å–º–æ—Ç—Ä–µ–Ω–∏–µ, –Ω–æ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ:

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–≥–æ consumer'–∞ (–≤ —ç—Ç–æ–º –∂–µ –ø—Ä–æ–µ–∫—Ç–µ), –∫–æ—Ç–æ—Ä—ã–π:

—á–∏—Ç–∞–µ—Ç —ç—Ç–∏ —Å–æ–±—ã—Ç–∏—è,

–ª–æ–≥–∏—Ä—É–µ—Ç —Ñ–∞–∫—Ç –ø–æ–ª—É—á–µ–Ω–∏—è —Å–æ–±—ã—Ç–∏—è —Å trace_id,

–º–æ–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –ø–∏—Å–∞—Ç—å ¬´–ø–æ–ª—É—á–µ–Ω–æ —Å–æ–±—ã—Ç–∏–µ user.created —Å user_id=X¬ª.

–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ consumer'–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π ‚Äî –≤–∞–∂–Ω–æ –ø–æ–∫–∞–∑–∞—Ç—å:

–∫–∞–∫ –≤—ã –æ—Ç–¥–µ–ª—è–µ—Ç–µ producer / consumer,

–∫–∞–∫ –ø—Ä–æ—Ö–æ–¥–∏—Ç—Å—è trace_id —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å.

–ü–æ–¥—Å–∫–∞–∑–∫–∞: consumers –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ lifespan (LiteStar)

 

3.2. –£–ø—Ä–æ—â—ë–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç (–µ—Å–ª–∏ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–∏)
–ï—Å–ª–∏ —É –≤–∞—Å –Ω–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–∞–±–æ—Ç—É —Å –æ—á–µ—Ä–µ–¥—å—é, –¥–æ–ø—É—Å–∫–∞–µ—Ç—Å—è —É–ø—Ä–æ—â—ë–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –≤—ã –ø–æ–∫–∞–∂–µ—Ç–µ:

—Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ—ë–≤ (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ / –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ / –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏),

–ø–∞–ø–∫–∏ —Å —Ä–µ–±–±–∏—Ç–æ–º –∏ –Ω–∞–∑–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤ –ø–æ–¥ –Ω–µ–≥–æ.

–º–µ—Å—Ç–æ –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ producer/consumer –±–µ–∑ –ø–µ—Ä–µ–ø–∏—Å—ã–≤–∞–Ω–∏—è –æ—Å—Ç–∞–ª—å–Ω–æ–≥–æ –∫–æ–¥–∞).

 

üß± –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π
–ö–æ–º–ø–æ–Ω–µ–Ω—Ç

–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è

Backend

Python 3.12, LiteStar (–≤–µ—Ä—Å–∏—è 2.x)

–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

PostgreSQL + Advanced SQLAlchemy

–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

structlog

–û—á–µ—Ä–µ–¥—å / RabbitMQ

RabbitMQ + aio-pika = "^9.5.4" + faststream = { extras = ["cli"], version = "^0.5.34" }

Redis

redis (–≤—Ä–µ—Å–∏—è 5.x,  –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ / –ø–æ –∂–µ–ª–∞–Ω–∏—é )

–ü–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä

Poetry 1.8.3

–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

Docker / docker-compose (–ø–æ –∂–µ–ª–∞–Ω–∏—é)

üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–∞–±–ª–∏—Ü—ã user
–ü–æ–ª–µ

–¢–∏–ø

–û–ø–∏—Å–∞–Ω–∏–µ

id

BIGINT PRIMARY KEY (–∞–≤—Ç–æ–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç)

–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä

name

TEXT

–ò–º—è

surname

TEXT

–§–∞–º–∏–ª–∏—è

password

TEXT

–ü–∞—Ä–æ–ª—å

created_at

TIMESTAMP (UTC-0)

–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

updated_at

TIMESTAMP (UTC-0)

–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

üì¶ –ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏


python = "^3.12"
python-dotenv = "^1"
litestar = { extras = ["standard"], version = "^2" }
litestar-granian = "^0"
litestar-asyncpg = "^0"
advanced-alchemy = "^0.20"
msgspec = "^0.18.6"
structlog = "^24"
aio-pika = "^9.5.4"
faststream = { extras = ["cli"], version = "^0.5.34" }
üöÄ –ö–∞–∫ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ä–µ—à–µ–Ω–∏–µ
–í—ã–ª–æ–∂–∏—Ç–µ –∫–æ–¥ –≤ –ø—É–±–ª–∏—á–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π GitHub.

–ü—Ä–∏—à–ª–∏—Ç–µ —Å—Å—ã–ª–∫—É –∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–æ –∑–∞–ø—É—Å–∫—É –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

–ü—Ä–∏–º–µ—Ä:



–°—Å—ã–ª–∫–∞ –Ω–∞ GitHub: https://github.com/username/project
–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:
1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π:
   git clone https://github.com/username/project
2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç:
   docker-compose up -d
   # –∏–ª–∏
   uvicorn app.asgi:app --host 127.0.0.1 --port 8000
3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:
   litestar database upgrade
4. –í—Ä–µ–º—è, –∑–∞—Ç—Ä–∞—á–µ–Ω–Ω–æ–µ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ:
   [—É–∫–∞–∑–∞—Ç—å –≤—Ä–µ–º—è]
